# 1.CAN协议中CAN报文种类

报文传输过程中有：**数据帧**、**远程帧**、**错误帧**、**过载帧**和**帧间隔**。

# 2.CAN报文的组成

通常接收到的CAN报文由很多部分（图1）组成。

解析报文时用到的主要是**帧ID**和**数据**两部分。![在这里插入图片描述](https://img-blog.csdnimg.cn/20210206190802847.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0xpdVhGOTM=,size_16,color_FFFFFF,t_70)

## 2.1 帧ID的组成

```tex
182756F4

二进制：

1100 0001 0011 1010 1011 0111 1010 0
```

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210206190532972.png)

表1中，P为优先级，有3位，可以有8个优先级（ 0 ~ 7 ）；R为保留位，有 1位，固定为0 ；DP为数据页，有1位，固定为0；PF为报文的代码，有8 位；PS为报文的目标地址（也就是报文的接收方），有8位；SA为报文的源地址（也就是报文的接收方），有8位。

例子：

P（优先级 3位）：110——6

R（保留位 1位）：0——0

DP（数据页 1位）：0——0

PF（报文代码，8位）：0010 0111——39

PS（目标地址 8位）：0101 0110——86

SA（源地址 8位）：1111 0100——244

## 2.2 数据段的组成

数据段一般由1 ~ 8个字节（Byte）组成，来代表通信协议中相应的含义。

**每个字节有2个字符**，分为高4位和低4位。有的数据需要相邻的2个字节组合才能表示，则需要分为高字节和低字节。

例如 ，收到表2所示通信协议中需要的报文（ID:1818D0F3 ）：
**1818D0F3 ce 0d 00 7d 00 6d 11 00** 
第 1 个字节ce中的c为高 4 位，e为低 4 位。

第 1 、 2字节表示总电压，而且注明Byte 1 为低字节，Byte 2 为高字节，那么解析时就应该为： 0dce

# 3.CAN报文的解析

根据需要收到CAN报文之后，需要根据**具体的通信协议解析**，然后分析解析出的数据是否正确。下面进行报文实例解析。数据类型定义如表 4 所示。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210206213716282.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0xpdVhGOTM=,size_16,color_FFFFFF,t_70)

报文内容如表2所示。收到的报文为:

**1818D0F3 ce 0d 00 7d 00 6d 11 00** 

协议中规定报文的第一、二字节表示总电压，高字节在前，低字节在后。又总电压的单位为0.1 V。所以在上面的数据中 0dce代表总电压，转为十进制为 3534,乘以0.1V的单位，则得到总电压值为353.4 V。

协议中规定报文的第三、四字节表示总电流，又总电流的单位为 0.1A，偏移量为 32000 。所以在上面的数据中 7d00 代表总电流，转为十进制为32000 ，乘以 0.1 再减去 3200 的偏移量等于0 ，则说明此时电池组没有被充电或放电，电流为 0 。
协议中规定报文的第六、七字节表示最高电池电压及位置。单体电池电压单位为0.01V。最高 4 位代表箱号。所以在上面的数据中116d 代表最高电池电压及位置，其中1代表箱号，即最高电池电压在第1 箱。 116 d代表最高电池电压，转为十进制为 365 ，乘以 0.01 A的单位，则得到最高电池电压为3.65 V。

# 自试用例子

0060,0,88,1CEB56F4,01,01,01,00,03,46,05,80

1CEB56F4——1 1100 1110 1011 0101 0110 1111 0100

P（优先级 3位）：111——7

R（保留位 1位）：0——0

DP（数据页 1位）：0——0

PF（报文代码，8位）：1110 1011——235

PS（目标地址 8位）：0101 0110——86

SA（源地址 8位）：1111 0100——244

————————————————————————————————

01,01,01,00,03,46,05,80

协议中规定报文的第一、二字节表示**总电压**，高字节在前，低字节在后。又总电压的单位为0.1 V。所以在上面的数据中 0101代表总电压，转为十进制为 257,乘以0.1V的单位，则得到总电压值为25.7V。

协议中规定报文的第三、四字节表示**总电流**，又总电流的单位为 0.1A，偏移量为 32000 。所以在上面的数据中 0100代表总电流，转为十进制为256，乘以 0.1 再减去 3200 的偏移量等于-3174.4 ，则说明此时电池组在放电中，电流为3174.4
协议中规定报文的第六、七字节表示**最高电池电压及位置**。单体电池电压单位为0.01V。最高 4 位代表箱号。所以在上面的数据中0546 代表最高电池电压及位置，其中0代表箱号，即最高电池电压在第0 箱。 0546代表最高电池电压，转为十进制为 1350 ，乘以 0.01 A的单位，则得到最高电池电压为1.35V。